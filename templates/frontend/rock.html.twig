{% extends 'base.html.twig' %}

{% block title %}Munichclimbs | {% endblock %}

{% block bodyclass %}scrollspy-example{% endblock %}
{% block body %}
    <main class="pt-3">
		<div class="container my-5">
		{% for rockAttribute in rock %}
		{#{dump(rockAttribute)}#}
		
			<section>
				<div
					class="bg-image py-3 rounded d-flex align-items-start background-image-height"
					style="background-image: "
				>
					<div 
						class="p-3 shadow-3 alert-light d-flex justify-content-between w-100"
						style="background-color: rgba(255, 255, 255, 0.6);"
					>
						<h1 class="h2 mb-0 fw-bold text-black ">
							{{ rockAttribute.name }}
						</h1>
						<div class="align-self-start">
							<button 
								type="button" 
								class="btn btn-sm btn-primary btn-floating"
								data-mdb-toggle="modal" 
								data-mdb-target="#infoModal" 
							>
								<i class="fas fa-info"></i>
							</button>
							<button 
								type="button" 
								class="btn btn-sm btn-primary btn-floating ms-2"
								data-mdb-toggle="modal" 
								data-mdb-target="#exampleModal" 
							>
								<i class="far fa-images"></i>
							</button>
						</div>
					</div>
				</div>
			</section>
			<section>
				<div class="row">
					<div class="col-md-12">
						{% set currentDate =  "now"|date("z") %}
						{% if rockAttribute.banned == 1 and currentDate < 181 %}
							<div class="alert alert-danger my-3" role="alert" data-mdb-color="danger">
								<strong class="font-bold">Jahreszeitliche Sperrung!</strong>
								<span class="block sm:inline">{{ rockAttribute.name }} ist leider noch bis zum 30.06. gesperrt!</span>
							</div>
						{% endif %}
					</div>
				</div>
					{#<div class="row">
						<div class="col-md-9">
							<section>
								<?php
									$valuesToReplace = array(' ' => '', '\'' => '', 'ß' => 'ss', '.' => '');
									for ($valueTopo = 1; $valueTopo <= $num_rows; $valueTopo++) {
										$getValuesTopo	= getParamsWithTopo($rockName, $valueTopo);
										$nameTopo		= $getValuesTopo->fetch();
								?>
									<div class="card mt-3" style="overflow: hidden;">
										<div class="card-body p-0 p-md-3" style="overflow: hidden;">
											<section id="<?php echo strtr(strtolower($nameTopo['topoName']), $valuesToReplace); ?>">
												<?php 
													if(isset($nameTopo['topoWithSector'])) {
												?>
													<h3 class="pb-md-1 px-2 pt-2 pt-md-0 px-md-0"><?php echo $nameTopo['topoName']; ?></h3>
												<?php
													}
												?>
												<?php 
													if($nameTopo['topoImage'] != NULL && $nameTopo['topoSVG'] == NULL) {
												?>
													<img 
														src="<?php echo BASE_URL; ?>images/topos/<?php echo $nameTopo['topoImage']; ?>" 
														alt="Klettern im <?php echo $nameTopo['areaName']; ?> Topo zum Kletterfels <?php echo $nameTopo['topoName']; ?>" 
														class="img-fluid mb-3">
												<?php 
													} elseif(isset($nameTopo['topoSVG'])) {
														echo '<div class="mb-3">';
														echo $nameTopo['topoSVG'];
														echo '</div>';
													}
												?>
												<div class="table-responsive">
													<table class="table table-striped table-sm">
														<?php 
															$count = 1;
															$getValuesRoutes	= getParamsWithTopo($rockName, $valueTopo);
															while($values = $getValuesRoutes->fetch()) { 
																$areaNeu 			= $values['areaId'];
																$rock 				= $values['rockAreaId'];
																$rockImage			= $values['rockNr'];
																$rockId				= $values['rockId'];
																$route 				= $values['routesNr'];
																$routesid 			= $values['routesId'];
														?>
														<tr>
															<td><?php echo $count; ?></td>
															<td>
																<!--<div class="d-flex align-items-center">-->
																	<?php echo $values['routesName']; ?>
																	<?php echo $routes->routeProtection($values['routesProtection']); ?>
																	<?php echo $routes->routeBeauty($values['routesRating']); ?>
																	<?php 
																		$video = $videos->right_video($areaNeu, $rockId, $routesid); include(ROOT_PATH . 'includes_videos.php'); 
																	?>
																	<!--<div class="lightbox inline-block" data-mdb-zoom-level="0.5"> -->
																		<?php 
																			//$test = $images->right_image($areaNeu, $rockId, $routesid); 
																			//include(ROOT_PATH . 'includes_photos.php'); 
																		?>
																	<!--</div>
																</div>-->
															</td>
															<td><?php echo $values['routesGrade']; ?></td>
															<td class="d-none d-lg-table-cell" style="white-space: nowrap;">
																<?php 
																	if (isset($values['routesFirstAscent'])) {
																		echo $values['routesFirstAscent'];
																	} else {
																		echo '&nbsp;';
																	}
																	if (isset($values['routesYearFirstAscent']) && $values['routesYearFirstAscent'] != 0) {
																		echo " " . $values['routesYearFirstAscent'];
																	} else {
																		echo '&nbsp;';
																	}
																?>
															</td>
															<td style="padding-top: 0.2rem;">
																<?php 
																	if (isset($values['routesDescription'])) {
																?>
																		<button 
																			type="button" 
																			class="btn btn-sm btn-primary btn-floating"
																			data-mdb-toggle="modal" 
																			data-mdb-target="#infoModal<?php echo preg_replace('/(\s|&(amp;)?|\.)+/', '', $values['routesName']); ?>"
																			style="width: 1.125rem;height: 1.125rem; background: transparent;"
																		>
																			<i class="fas fa-info fa-xs " style="width: 1.125rem;line-height: 1.12rem;"></i>
																		</button>
																<?php
																	}
																?>
																
															</td>
														</tr>
														<?php 
															$count++;
															}
														?>
													</table>
												</div>
											</section>
										</div>
									</div>
									<?php 
										$getValuesRoutes	= getParamsWithTopo($rockName, $valueTopo);
										while($values = $getValuesRoutes->fetch()) { 
									?>
									<div class="modal fade" id="infoModal<?php echo preg_replace('/(\s|&(amp;)?|\.)+/', '', $values['routesName']); ?>" tabindex="-1" aria-labelledby="infoModal<?php echo preg_replace('/(\s|&(amp;)?|\.)+/', '', $values['routesName']); ?>Label" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="infoModal<?php echo preg_replace('/(\s|&(amp;)?|\.)+/', '', $values['routesName']); ?>Label"><?php echo $values['routesName']; ?> <?php echo $values['routesGrade']; ?> <?php echo $routes->routeBeauty($values['routesRating']); ?></h5>
													<button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
												</div>
												<div class="modal-body">
													<p class="d-lg-none" style="font-size: .85rem;">Erstbegeher: 
														<?php 
															if (isset($values['routesFirstAscent'])) {
																echo $values['routesFirstAscent'];
															} else {
																echo '&nbsp;';
															}
															if (isset($values['routesYearFirstAscent']) && $values['routesYearFirstAscent'] != 0) {
																echo " " . $values['routesYearFirstAscent'];
															} else {
																echo '&nbsp;';
															}
														?>
													</p>
													<p style="font-size: .85rem;"><?php echo $values['routesDescription']; ?></p>
												</div>
											</div>
										</div>
									</div>
									<?php 
										}
									?>
								<?php } ?>
							</section>
						</div>
						<?php if($nameTopo['topoWithSector'] == 1) { ?>
							<div class="col-md-3 d-none d-lg-block position-relative">
								<div id="scrollspy-collapsible" class="sticky-top" style="top: 80px;">
									<div class="card mt-3">
										<div class="card-body">
											<ul 
												class="nav flex-column nav-pills menu-sidebar" 
												data-mdb-allow-hashes="true"
											>
												<?php
													$i = 0;
													for ($valueTopo = 1; $valueTopo <= $num_rows; $valueTopo++) {
														$getValuesTopo	= getParamsWithTopo($rockName, $valueTopo);
														$nameTopo		= $getValuesTopo->fetch();
												?>
												<li class="nav-item">
													<a 
														class="nav-link" 
														href="#<?php echo strtr(strtolower($nameTopo['topoName']), $valuesToReplace); ?>"
														data-mdb-smooth-scroll="smooth-scroll"
														data-mdb-easing="easeInOutQuart"
													><?php echo $nameTopo['topoName']; ?></a>
												</li>
												<?php } ?>
											</ul>
										</div>
									</div>
								</div>
							</div>
						<?php } ?>
					</div>#}
				</section>
				<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Allgemeine Informationen  {{ rockAttribute.name }}</h5>
								<button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<div class="accordion" id="accordionExample">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingAllgemein">
										<button
											class="accordion-button"
											type="button"
											data-mdb-toggle="collapse"
											data-mdb-target="#collapseAllgemein"
											aria-expanded="true"
											aria-controls="collapseAllgemein"
										>
											Allgemein
										</button>
										</h2>
										<div id="collapseAllgemein" class="accordion-collapse collapse show" aria-labelledby="headingAllgemein" data-mdb-parent="#accordionExample">
											<div class="accordion-body p-0">
												
												<table class="table table-striped table-sm">
													<tr>
														<td colspan="2">
															<div class="d-flex me-2">
																<div class="d-flex flex-column me-2">
																	<div class="text-center bg-warning px-2 py-1 text-white" style="font-size: 14px;">Anzahl</div>
																		<div class="text-center text-white bg-warning mt-1">
																			<div class="px-2 py-1" style="font-size: 14px;">
																				{{ rockAttribute.routes|length }} 
																			</div>
																		</div>
																	</div>
																	{#<?php 
																		$prozentRock 	= 100/$routes->amountRoutesRock($rockId);
																		$easy 			= $prozentRock * $routes->getGradeForRock($rockId, 0, 15);
																		$middle 		= $prozentRock * $routes->getGradeForRock($rockId, 15, 29);
																		$hard 			= $prozentRock * $routes->getGradeForRock($rockId, 29, 60);
																		$project 		= $prozentRock * $routes->projectsRock($rockId);
																		$grading = array(
																		'easy' 		=> array("#15803d", "1 - 5", $easy, 0, 15),
																		'middle' 	=> array("#075985", "6 - 7", $middle, 15, 29),
																		'hard' 		=> array("#b91c1c", "8 - 11", $hard, 29, 60),
																		'project' 	=> array("black", "Proj.", $project),
																		);
																		foreach($grading as $i => $value) {
																	?>#}
																	<div class="d-flex flex-column me-2">
																		<div style="background-color:#15803d; font-size: 14px;" class="text-center px-2 py-1 text-white" >1 - 5</div>
																		<div class="text-center text-white bg-gray-400 mt-1">
																			<div style="background-color:#15803d; font-size: 14px;" class=" px-2 py-1">
																			{% set easy = '' %}
																			 {% for amountGrade in rockAttribute.routes %}
																			 {% set now = amountGrade.gradeNo|length %}
																				{% if amountGrade.gradeNo < 15 %}
																					
																					{% set easy = now %}
																				{% else %}
																					0
																				{% endif %}
																			{% endfor %} 
																			</div>
																		</div>	
																	</div>	
																	<div class="d-flex flex-column me-2">
																		<div style="background-color:#075985; font-size: 14px;" class="text-center px-2 py-1 text-white" >6 - 7</div>
																		<div class="text-center text-white bg-gray-400 mt-1">
																			<div style="background-color:#075985; font-size: 14px;" class=" px-2 py-1">
																			{% set middle = '' %}
																				{% for amountGrade in rockAttribute.routes %}
																					{% set test = amountGrade.gradeNo|length %}
																					{% if amountGrade.gradeNo > 15 and  amountGrade.gradeNo < 29 %}
																						{{test}}
																						
																					{% endif %}
																					{% set middle = test %}
																				{% endfor %} 
																			</div>
																		</div>	
																	</div>	
																	<div class="d-flex flex-column me-2">
																		<div style="background-color:#b91c1c; font-size: 14px;" class="text-center px-2 py-1 text-white" >8 - 11</div>
																		<div class="text-center text-white bg-gray-400 mt-1">
																			<div style="background-color:#b91c1c; font-size: 14px;" class=" px-2 py-1">
																				zahl
																			</div>
																		</div>	
																	</div>	
																	<div class="d-flex flex-column me-2">
																		<div style="background-color:black; font-size: 14px;" class="text-center px-2 py-1 text-white" >Proj.</div>
																		<div class="text-center text-white bg-gray-400 mt-1">
																			<div style="background-color:black; font-size: 14px;" class=" px-2 py-1">
																				zahl
																			</div>
																		</div>	
																	</div>
																</div>
															</div>
														</td>
													</tr>
													<tr>
														<td>Höhe:</td>
														<td>{{ rockAttribute.height}} m</td>
													</tr>
													<tr>
														<td>Ausrichtung:</td>
														<td>{{ rockAttribute.orientation}}</td>
													</tr>
													<tr>
														<td>Sonnig:</td>
														<td>
															{% if rockAttribute.sunny == 1 %}
																keine Sonne
															{% elseif rockAttribute.sunny == 2 %}
																teils Sonne
															{% else %}
																sonnig
															{% endif %}
														</td>
													</tr>
													<tr>
														<td>Kindereignung:</td>
														<td>
															{% if rockAttribute.childFriendly == 1 %}
																gut geeignet
															{% elseif rockAttribute.childFriendly == 2 %}
																teils geeignet
															{% elseif rockAttribute.childFriendly == 3 %}
																ungeeignet
															{% else %}
																keine Angaben
															{% endif %}
														</td>
													</tr>
													<tr>
														<td>Regengeschützt:</td>
														<td>
															{% if rockAttribute.rain == 1 %}
																regensicher
															{% elseif rockAttribute.rain == 2 %}
																kaum regensicher
															{% elseif rockAttribute.rain == 3 %}
																nicht regensicher
															{% endif %}
														</td>
													</tr>
													<tr>
														<td>GPS:</td>
														<td>{{ rockAttribute.lat }}, {{ rockAttribute.lng }}</td>
													</tr>
													<tr>
														<td>Jahreszeit:</td>
														<td>{{ rockAttribute.season}}</td>
													</tr>
													{% if rockAttribute.zone %}
													<tr>
														<td>Zone:</td>
														<td>{{ rockAttribute.zone }}</td>
													</tr>
													{% endif %}
												</table>
											</div>
										</div>
									</div>
									{% if rockAttribute.description %}
										<div class="accordion-item">
											<h2 class="accordion-header" id="headingBeschreibung">
											<button
												class="accordion-button collapsed"
												type="button"
												data-mdb-toggle="collapse"
												data-mdb-target="#collapseBeschreibung"
												aria-expanded="false"
												aria-controls="collapseBeschreibung"
											>
												Beschreibung
											</button>
											</h2>
											<div id="collapseBeschreibung" class="accordion-collapse collapse" aria-labelledby="headingBeschreibung" data-mdb-parent="#accordionExample">
												<div class="accordion-body">
													<p class="fs-6">{{ rockAttribute.description }}</p>
												</div>
											</div>
										</div>
									{% endif %}
									{% if rockAttribute.access %}
										<div class="accordion-item">
											<h2 class="accordion-header" id="headingZustieg">
											<button
												class="accordion-button collapsed"
												type="button"
												data-mdb-toggle="collapse"
												data-mdb-target="#collapseZustieg"
												aria-expanded="false"
												aria-controls="collapseZustieg"
											>
												Zustieg
											</button>
											</h2>
											<div id="collapseZustieg" class="accordion-collapse collapse" aria-labelledby="headingZustieg" data-mdb-parent="#accordionExample">
											<div class="accordion-body">
												{{ rockAttribute.access }}
											</div>
											</div>
										</div>
									{% endif %}
									{% if rockAttribute.nature %}
										<div class="accordion-item">
											<h2 class="accordion-header" id="headingNaturschutz">
											<button
												class="accordion-button collapsed"
												type="button"
												data-mdb-toggle="collapse"
												data-mdb-target="#collapseNaturschutz"
												aria-expanded="false"
												aria-controls="collapseNaturschutz"
											>
												Naturschutz
											</button>
											</h2>
											<div id="collapseNaturschutz" class="accordion-collapse collapse" aria-labelledby="headingNaturschutz" data-mdb-parent="#accordionExample">
											<div class="accordion-body">
												{{ rockAttribute.nature }}
											</div>
											</div>
										</div>
									{% endif %}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% endfor %} 
		{{ include('pageParts/footer.html.twig') }}
    </main>
{% endblock %}